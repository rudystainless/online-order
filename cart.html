<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ショッピングカート - RUDY</title>
    <style>
        /* 全体のスタイル：ミニマリズムデザイン */
        body { font-family: "Helvetica Neue", Arial, sans-serif; padding: 20px; background-color: #fff; color: #333; max-width: 800px; margin: 0 auto; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 15px; text-transform: uppercase; letter-spacing: 2px; text-align: center; }
        
        /* テーブルのスタイル */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background-color: #f9f9f9; text-align: left; padding: 12px; border-bottom: 2px solid #eee; font-size: 13px; }
        td { padding: 15px 10px; border-bottom: 1px solid #eee; }
        
        /* 商品情報のスタイル */
        .product-info { display: flex; align-items: center; }
        .product-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; margin-right: 15px; background-color: #f0f0f0; }
        .product-name-text { font-size: 14px; font-weight: 500; }

        /* 数量調整と削除 */
        .qty-controls { display: flex; align-items: center; gap: 10px; }
        .btn-qty { width: 25px; height: 25px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
        .btn-delete { background: none; border: none; color: #999; cursor: pointer; font-size: 18px; }
        .btn-delete:hover { color: #d32f2f; }

        .total-row { font-weight: bold; font-size: 16px; background-color: #fafafa; }
        
        /* フォーム入力 */
        .customer-form { margin-top: 40px; border-top: 1px solid #333; padding-top: 20px; }
        .form-group { margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 0; box-sizing: border-box; font-size: 14px; }
        
        /* 送信ボタン */
        .btn-submit { background: #1a1a1a; color: white; width: 100%; padding: 18px; border: none; cursor: pointer; font-size: 15px; letter-spacing: 2px; transition: 0.3s; }
        .btn-submit:hover { background: #444; }
        .btn-submit:disabled { background: #ccc; cursor: not-allowed; }

        .btn-clear { background: none; border: 1px solid #ccc; color: #666; padding: 5px 10px; font-size: 11px; cursor: pointer; float: right; }
    </style>
</head>
<body>

    <button class="btn-clear" onclick="clearCart()">EMPTY CART (クリア)</button>
    <h2>SHOPPING CART</h2>
    
    <table id="cartTable">
        <thead>
            <tr>
                <th>PRODUCT</th>
                <th>PRICE</th>
                <th>QTY</th>
                <th>SUBTOTAL</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="cartItems">
            </tbody>
    </table>

    <div class="customer-form">
        <h3>CUSTOMER INFO</h3>
        <div class="form-group"><input type="text" id="company" placeholder="会社名 / Company Name (必須)" required></div>
        <div class="form-group"><input type="text" id="person" placeholder="担当者名 / Contact Person (必須)" required></div>
        <div class="form-group"><input type="text" id="phone" placeholder="電話番号 / Phone Number"></div>
        <div class="form-group"><input type="email" id="email" placeholder="メールアドレス / Email"></div>
        <div class="form-group"><textarea id="note" placeholder="備考 / Note" rows="4"></textarea></div>
        <button class="btn-submit" id="submitBtn" onclick="sendToOrderGAS()">ORDER CONFIRM (注文を確定する)</button>
    </div>

    <script>
        /**
         * 【重要】注文を受け取る「注文処理GAS」のURL
         * (重要：填入接收訂單並扣庫存的那組 GAS 網址)
         */
        const ORDER_GAS_URL = "https://script.google.com/macros/s/AKfycbyaBHpHBLGm61UM7R9k4qTHjg2NO0ly5JRYQwFf76-pwI8Ai3cKGvqeyKfWq7Mzoxxq2w/exec";

        // カート内容を表示する関数
        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('rudy_cart') || '[]');
            const tbody = document.getElementById('cartItems');
            let total = 0;
            
            if (cart.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 50px; color: #999;">カートに商品が入っていません。</td></tr>';
                return;
            }

            tbody.innerHTML = cart.map((item, index) => {
                const subtotal = item.price * item.qty;
                total += subtotal;
                return `
                <tr>
                    <td>
                        <div class="product-info">
                            <img src="${item.img || ''}" class="product-thumb">
                            <span class="product-name-text">${item.name}</span>
                        </div>
                    </td>
                    <td>¥${item.price.toLocaleString()}</td>
                    <td>
                        <div class="qty-controls">
                            <button class="btn-qty" onclick="updateQty(${index}, -1)">-</button>
                            <span>${item.qty}</span>
                            <button class="btn-qty" onclick="updateQty(${index}, 1)">+</button>
                        </div>
                    </td>
                    <td>¥${subtotal.toLocaleString()}</td>
                    <td><button class="btn-delete" onclick="removeItem(${index})">✕</button></td>
                </tr>`;
            }).join('');

            tbody.innerHTML += `
                <tr class="total-row">
                    <td colspan="3" style="text-align:right">TOTAL:</td>
                    <td colspan="2" style="color:#d32f2f;">¥${total.toLocaleString()}</td>
                </tr>`;
        }

        // 数量変更
        window.updateQty = function(index, change) {
            let cart = JSON.parse(localStorage.getItem('rudy_cart') || '[]');
            cart[index].qty += change;
            if (cart[index].qty < 1) cart.splice(index, 1);
            localStorage.setItem('rudy_cart', JSON.stringify(cart));
            renderCart();
        };

        // 削除
        window.removeItem = function(index) {
            let cart = JSON.parse(localStorage.getItem('rudy_cart') || '[]');
            cart.splice(index, 1);
            localStorage.setItem('rudy_cart', JSON.stringify(cart));
            renderCart();
        };

        // カートを空にする
        window.clearCart = function() {
            localStorage.removeItem('rudy_cart');
            renderCart();
        };

        // 注文データをGASへ送信
        window.sendToOrderGAS = async function() {
            const cart = JSON.parse(localStorage.getItem('rudy_cart') || '[]');
            if (cart.length === 0) return alert("カートが空です");

            const payload = {
                company: document.getElementById('company').value,
                person: document.getElementById('person').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                note: document.getElementById('note').value,
                items: cart
            };

            if (!payload.company || !payload.person) {
                return alert("会社名と担当者名は必須入力項目です。");
            }

            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = "SENDING ORDER...";

            try {
                // POSTリクエストの送信
                await fetch(ORDER_GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-
